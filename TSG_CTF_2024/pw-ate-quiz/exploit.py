from pwn import *

DUMMY_INPUT = b"a"

io = remote("localhost", 41778)

io.sendlineafter(b"password", DUMMY_INPUT)

# 暗号化されたパスワード
io.sendlineafter(b"(0~2) > ", b"4")
encrypted_password = io.readline()[:-1]
io.sendlineafter(b"(0~2) > ", b"5")
encrypted_password += io.readline()[:-1]
io.sendlineafter(b"(0~2) > ", b"6")
encrypted_password += io.readline()[:-1]
io.sendlineafter(b"(0~2) > ", b"7")
encrypted_password += io.readline()[:-1]

# keyを推定
DUMMY_INPUT += b"\x00" * (8 - len(DUMMY_INPUT))
io.sendlineafter(b"(0~2) > ", b"8")
encrypted_input = io.readline()[:-1]
key = bytes([encrypted_input[i] ^ DUMMY_INPUT[i] for i in range(len(encrypted_input))])

# パスワードを復号化
password = bytes([encrypted_password[i] ^ key[i % 8] for i in range(len(encrypted_password))]).strip(b"\x00")

# パスワード送信
io.sendlineafter(b"(0~2) >", b"invalid")
io.sendlineafter(b"password >", password)

io.interactive()